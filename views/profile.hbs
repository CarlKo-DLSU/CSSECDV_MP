<div class="pro-main">
    <div class="pro-sidebar">
        <div class="pro-sidebar-bg">
            <h2 class="sb-name">{{ sb.name }}</h2>
            <div class="sb-pic hov1">
                <img src="/imgs/avatars/{{ sb.avatar }}" alt="">
            </div>
            <p class="sb-description">{{ sb.description }}</p>
            <div class="sb-stats">
                <p class="reviews"><span class="orange-bold">{{ sb.reviewCount }}</span> reviews</p>
                <p class="erms"><span class="orange-bold">{{ sb.erms }}</span> erms</p>
            </div>
            {{#if isCurrentUser}}
            <div class="edit-div">
                <a class="edit-user hov1" href="/edit/user">
                    <span class="icon icon-md edit-i"></span>
                    <p class="edit-user-text">EDIT USER</p>
                </a>
            </div>
            {{/if}}
        </div>
    </div>
    <div class="pro-review-holder">
        <div id="sortfilter">
            {{> sortfilter}}
        </div>

        {{!-- Admin control panel: only visible to admins --}}
        {{#hasRole currentUser 'admin'}}
        <div class="admin-control-panel">
            <h3 id="admin-title">Admin Controls</h3>

            <div class="admin-menu">
                <!-- Create new manager -->
                <form method="POST" action="/admin/create" class="admin-form">
                    <h4>Create New Manager</h4>
                    <input type="hidden" name="role" value="manager">
                    <label>Username: <input name="username" type="text" required minlength="1" maxlength="30"></label>
                    <label>Password: <input name="password" type="password" required minlength="8" maxlength="128"></label>
                    <button type="submit" class="admin-btn">Create Manager</button>
                </form>

                <!-- Create new admin -->
                <form method="POST" action="/admin/create" class="admin-form">
                    <h4>Create New Admin</h4>
                    <input type="hidden" name="role" value="admin">
                    <label>Username: <input name="username" type="text" required minlength="1" maxlength="30"></label>
                    <label>Password: <input name="password" type="password" required minlength="8" maxlength="128"></label>
                    <button type="submit" class="admin-btn">Create Admin</button>
                </form>

                <!-- Assign role to existing user -->
                <form method="POST" action="/admin/assign-role" class="admin-form" onsubmit="return confirm('Change role for this user?');">
                    <h4>Assign Role to User</h4>
                    <label>Select User:
                        <select name="username" required>
                            <option value="">-- Select User --</option>
                            {{#each allUsers}}
                            <option value="{{this.name}}">{{this.name}} ({{this.role}})</option>
                            {{/each}}
                        </select>
                    </label>
                    <label>New Role:
                        <select name="role" required>
                            <option value="reviewer">Reviewer</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                        </select>
                    </label>
                    <button type="submit" class="admin-btn">Assign Role</button>
                </form>

                <!-- Delete user -->
                <form method="POST" action="/admin/delete" class="admin-form" onsubmit="return confirm('Delete this user? This cannot be undone. All their reviews will also be deleted.');">
                    <h4>Delete User Account</h4>
                    <label>Select User:
                        <select name="username" required>
                            <option value="">-- Select User --</option>
                            {{#each allUsers}}
                            <option value="{{this.name}}">{{this.name}} ({{this.role}})</option>
                            {{/each}}
                        </select>
                    </label>
                    <button type="submit" class="admin-btn admin-btn-danger">Delete User</button>
                </form>

                <!-- Read-only application logs -->
                <div class="admin-logs">
                    <a class="admin-btn" href="/admin/logs" target="_blank">View Application Logs (read-only)</a>
                </div>
            </div>
        </div>
        {{/hasRole}}
        {{# if empty}}
        <div id="empty-reviews-msg">No reviews found (ￗ﹏ￗ )</div>
        {{/if}}
        {{> review reviews}}
    </div>
</div>

<script src="/js/rating.js"></script>
<script src="/js/sfReviews.js"></script>
