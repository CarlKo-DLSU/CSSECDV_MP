<div class="pro-main">
    <div class="pro-sidebar">
        <div class="pro-sidebar-bg">
            <h2 class="sb-name">{{ sb.name }}</h2>
            <div class="sb-pic hov1">
                <img src="/imgs/avatars/{{ sb.avatar }}" alt="">
            </div>
            <p class="sb-description">{{ sb.description }}</p>
            <div class="sb-stats">
                <p class="reviews"><span class="orange-bold">{{ sb.reviewCount }}</span> reviews</p>
                <p class="erms"><span class="orange-bold">{{ sb.erms }}</span> erms</p>
            </div>
            {{#if isCurrentUser}}
            <div class="edit-div">
                <a class="edit-user hov1" href="/edit/user">
                    <span class="icon icon-md edit-i"></span>
                    <p class="edit-user-text">EDIT USER</p>
                </a>
            </div>
            {{/if}}
        </div>
    </div>
    <div class="pro-review-holder">
        <div id="sortfilter">
            {{> sortfilter}}
        </div>

        {{!-- Admin control panel: only visible to admins --}}
        {{#hasRole currentUser 'admin'}}
        <div class="admin-control-panel">
            <h3 id="admin-title">Admin Controls</h3>

            <!-- Create manager/admin -->
            <div class="admin-menu">
                <form method="POST" action="/admin/create" class="admin-form">
                    <input type="hidden" name="role" value="manager">
                    <label>New Manager Username <input name="username" required></label>
                    <label>Password <input name="password" type="password" required></label>
                    <button type="submit" class="admin-btn">Create Manager</button>
                </form>

                <form method="POST" action="/admin/create" class="admin-form">
                    <input type="hidden" name="role" value="admin">
                    <label>New Admin Username <input name="username" required></label>
                    <label>Password <input name="password" type="password" required></label>
                    <button type="submit" class="admin-btn">Create Admin</button>
                </form>

                <!-- Assign role to this profile -->
                <form method="POST" action="/admin/assign-role" class="admin-form" onsubmit="return confirm('Change role for this user?');">
                    <input type="hidden" name="username" value="{{sb.name}}">
                    <label>Assign Role
                        <select name="role">
                            <option value="reviewer">Reviewer</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                        </select>
                    </label>
                    <button type="submit" class="admin-btn">Assign Role</button>
                </form>

                <!-- Read-only application logs -->
                <div class="admin-logs">
                    <a class="admin-btn" href="/admin/logs" target="_blank">View Application Logs (read-only)</a>
                </div>
            </div>
        </div>
        {{/hasRole}}
        {{# if empty}}
        <div id="empty-reviews-msg">No reviews found (ￗ﹏ￗ )</div>
        {{/if}}
        {{> review reviews}}
    </div>
</div>

<script src="/js/rating.js"></script>
<script src="/js/sfReviews.js"></script>
